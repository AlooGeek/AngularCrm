<div class="row">
  <!-- ============================================================== -->
  <!-- basic table  -->
  <!-- ============================================================== -->
  <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
      <div class="card">
          <h5 class="card-header">Store List</h5>
          <div class="card-body">
              <div class="table-responsive">
                  <table class="table table-striped table-bordered first" id="list">
                      <thead>
                          <tr>
                              <th>Name</th>
                              <th>Ville</th>
                              <th>Email</th>
                              <th>Address</th>
                              <th>Phone-Number</th>
                              <th><i class="fas fa-edit"></i> Update</th>
                              <th><i class="fas fa-trash-alt"> </i> Delete</th>
                              <th>Affectation</th>
                             
                          </tr>
                      </thead>
                      <tbody *ngFor="let s of listStores" >

                          <tr> 
                                 <td  class="affectprod" (click)="openLg3(content3,s.id)" style="text-align: center;"><img src="../../../../../assets/images/shop.jpg" width="150px" height="100px"> <br> {{s.name}}</td>
                                 <td>{{s.ville}}</td> 
                                 <td>{{s.email}} </td> 
                                 <td>{{s.address}}</td> 
                                 <td>{{s.phoneNumber}}</td> 
                                 <td><button class="btn btn-brand"   (click)="open(content,s)">Update</button></td>
                                 <td><button class="btn btn-danger" (click)="delete(s.id)">Delete</button></td>
                                 <td><button class="btn btn-dark" (click)="open2(content2,s)"><i class="fas fa-truck-loading"></i> Affect products</button> </td>
                                 

                          </tr>            
                          <!-- products of a Store-->      
                          
                      </tbody>
                      <tfoot>
                          <tr>
                            <th>Name</th>
                            <th>Ville</th>
                            <th>Email</th>
                            <th>Address</th>
                            <th>Phone-Number</th>
                            <th>Update</th>
                            <th>Delete</th>
                            <th>Affectation</th>
                          
                          </tr>
                      </tfoot>
                  </table>
              </div>
          </div>
      </div>
  </div>
  <!-- ============================================================== -->
  <!-- end basic table  -->
  <!-- ============================================================== -->
</div>
<div class="row">
  <div class="col-xl-12">
      <!-- ============================================================== -->
      <!-- pageheader  -->
      <!-- ============================================================== -->
      <div class="row">
          <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
              <div class="page-header" id="top">
                  <h2 class="pageheader-title">Add </h2>
                  
                  <div class="page-breadcrumb">
                      <nav aria-label="breadcrumb">
                          <ol class="breadcrumb">
                              <li class="breadcrumb-item"><a href="#" class="breadcrumb-link">Dashboard</a></li>
                              <li class="breadcrumb-item"><a href="#" class="breadcrumb-link">Store-Manage</a></li>
                          </ol>
                      </nav>
                  </div>
              </div>
          </div>
      </div>
      <!-- ============================================================== -->
      <!-- end pageheader  -->
      <!-- ============================================================== -->
   
      <!-- ============================================================== -->
      <!-- basic form  -->
      <!-- ============================================================== -->
      <div class="row">
      <div class=" col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12" >
          <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
              <div class="section-block" id="basicform">
                  <h3 class="section-title">Add Store</h3>
                 
              </div>
              <div class="card">
                 <div class="card-header d-flex">
                      <h4 class="card-header-title">Store</h4>
                 
                  </div>
                  <div class="card-body">
                      <form [formGroup]="StoreForm">

                           <div class="form-group">
                              <label for="inputText3" class="col-form-label" >Store Name</label>
                              <input type="text" class="form-control" id="inputText3" formControlName="name" >
                              <div *ngIf="sform.name.touched && sform.name.invalid">
                                      <div *ngIf="sform.name.errors.required" class="alert alert-danger">
                                       <i class="fas fa-minus-circle"></i> Store Name Is Required!
                                      </div>
                                      </div>
                           </div>

                           <div class="form-group">
                            <label for="inputEmail">City</label>
                            <!---->
                            <div  class="form-group" >

                           <select class="form-control" formControlName="ville">   
                           <option value="Ariana"> Ariana</option>
                            <option value="Béja"> Béja</option>
                              <option value="Ben Arous"> Ben Arous</option>
                                <option value="Bizerte"> Bizerte</option>
                                  <option value="Gabes"> Gabes</option>
                                    <option value="Gafsa"> Gafsa</option>
                                      <option value="Jendouba"> Jendouba</option>
                                        <option value="Kairouan"> Kairouan</option>
                                          <option value="Kasserine"> Kasserine</option>
                                            <option value="Kebili"> Kebili</option>
                                              <option value="La Manouba"> La Manouba</option>
                                                <option value="Le Kef"> Le Kef</option>
                                                  <option value="Mahdia"> Mahdia</option>
                                                    <option value="Médenine"> Médenine</option>
                                                      <option value="Monastir"> Monastir</option>
                                                        <option value="Nabeul"> Nabeul</option>
                                                          <option value="Sfax"> Sfax</option>
                                                            <option value="Sidi Bouzid"> Sidi Bouzid</option>
                                                              <option value="Siliana"> Siliana</option>
                                                                <option value="Sousse"> Sousse</option>
                                                                  <option value="Tataouine"> Tataouine</option>
                                                                    <option value="Tozeur"> Tozeur</option>
                                                                      <option value="Tunis"> Tunis</option>
                                                                        <option value="Zaghouan"> Zaghouan</option>
                           
                                                     

                           </select>
                         
                            <div *ngIf="sform.ville.touched && sform.ville.invalid">
                              <div *ngIf="sform.ville.errors.required" class="alert alert-danger">
                               <i class="fas fa-minus-circle"></i> Please choose a City !
                              </div>
                              </div>
                  </div>
          </div>

                     
                       

                           <div class="form-group">
                            <label for="inputText3" class="col-form-label" >Email</label>
                            <input type="text" class="form-control" id="inputText3" formControlName="email" >
                            <div *ngIf="sform.email.touched && sform.email.invalid">
                                    <div *ngIf="sform.email.errors.required" class="alert alert-danger">
                                     <i class="fas fa-minus-circle"></i> Email Is Required!
                                    
                                    </div>
                                    <div *ngIf="sform.email.errors.pattern" class="alert alert-danger">
                                      <i class="fas fa-minus-circle"></i>Invalid E-mail!
                                    </div>
                                    </div>
                         </div>
                         <div class="form-group">
                          <label for="inputText3" class="col-form-label" >Phone number</label>
                          <input type="text" class="form-control" id="inputText3" formControlName="phnbr" >
                          <div *ngIf="sform.phnbr.touched && sform.phnbr.invalid">
                                  <div *ngIf="sform.phnbr.errors.required" class="alert alert-danger">
                                   <i class="fas fa-minus-circle"></i> Phone number Is Required!

                                 
                                  </div>
                                    <div *ngIf="sform.phnbr.errors.maxlength||sform.phnbr.errors.minlength" class="alert alert-danger">
                                    <i class="fas fa-minus-circle"></i> Phone must have 8 numbers!
                                    </div>
                                
                                  </div>
                       </div>

                      <!--Map--> 
                       <div class="container">
          
                        <div class="form-group">
                          <label>Enter address</label>
                          <input type="text" class="form-control" (keydown.enter)="$event.preventDefault()" placeholder="Search Nearest Location" value="{{address}}"  autocorrect="off" autocapitalize="off" spellcheck="off" type="text" #search>
                        </div>
                       
                        <agm-map [latitude]="latitude" [longitude]="longitude" [zoom]="zoom">
                          <agm-marker [latitude]="latitude" [longitude]="longitude" [markerDraggable]="true"
                            (dragEnd)="markerDragEnd($event)"></agm-marker>
                        </agm-map>
                       
                        <h5>Address: {{address}}</h5>
                        <!--
                        <div>Latitude: {{latitude}}</div>
                        <div>Longitude: {{longitude}}</div>
                        -->
                      </div>

                          <button class="btn btn-primary"  (click)="addStore()" [disabled]="StoreForm.invalid" ><a href="/admin/store#list" style="color: white;"> Save </a></button>
                         
                      </form>
                  </div>
                  
              </div>
          </div>
      </div>
      <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12" id="#list">
              <div class="section-block" id="basicform">
                      <h3 class="section-title">List Store</h3>
                     
                  </div>
          <div class="card">
                  <div class="table-responsive">
                          <table class="table table-striped table-bordered first">
                              <thead>
                                  <tr>
                                      <th>Name</th>
                                      <th>Location</th>
                                      
                                  </tr>
                              </thead>
                              <tbody *ngFor="let s of listStores">
  
                                  <tr> 
                                         <td>{{s.name}}</td>
                                         <td style="text-align: center;"><button class="btn btn-brand"  (click)="open1(content1,s)"><i class="fas fa-map-marker-alt"></i> View Location</button> </td>
                                         
                                  </tr>
                                  
                              </tbody>
                              <tfoot>
                                  <tr>
                                    <th>Name</th>
                                      <th>Location</th>
                                  </tr>
                              </tfoot>
                          </table>
                      </div>
              
           
          
      </div>
      </div>

      <!-- ============================================================== -->
      <!-- end basic form  -->
      <!-- ============================================================== -->
      <!-- ============================================================== -->
     
  </div>
  <!-- ============================================================== -->
  <!-- sidenavbar -->
  <!-- ============================================================== -->

  <!-- ============================================================== -->
  <!-- end sidenavbar -->
  <!-- ============================================================== -->
</div>

</div>

<!--agm-map-->

<ng-template #content1 let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Store Location</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <h1> {{texto}}</h1>
    <agm-map [latitude]="lat" [zoom]="zoom" [longitude]="lng">
      <agm-marker  [latitude]="lat" [longitude]="lng"></agm-marker>
    </agm-map>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Close</button>
  </div>
</ng-template>



<!--Update FORM-->


<ng-template #content let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Store update</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">  
      
      <form [formGroup]="StoreUpdateForm">

        <div class="form-group">
          <label for="inputText3" class="col-form-label" >Store Name</label>
          <input type="text" class="form-control" id="inputText3" formControlName="name" value="{{storeUpdate.name}}" >
          <div *ngIf="suform.name.touched && suform.name.invalid">
                  <div *ngIf="suform.name.errors.required" class="alert alert-danger">
                   <i class="fas fa-minus-circle"></i> Store Name Is Required!
                  </div>
                  </div>
       </div>

       <div class="form-group">
        <label for="inputEmail">City</label>
        <!---->
        <div  class="form-group" >

       <select class="form-control" formControlName="ville">   
         <option value="{{storeUpdate.ville}}" [selected]="true"> {{storeUpdate.ville}} </option>
       <option value="Ariana"> Ariana</option>
        <option value="Béja"> Béja</option>
          <option value="Ben Arous"> Ben Arous</option>
            <option value="Bizerte"> Bizerte</option>
              <option value="Gabes"> Gabes</option>
                <option value="Gafsa"> Gafsa</option>
                  <option value="Jendouba"> Jendouba</option>
                    <option value="Kairouan"> Kairouan</option>
                      <option value="Kasserine"> Kasserine</option>
                        <option value="Kebili"> Kebili</option>
                          <option value="La Manouba"> La Manouba</option>
                            <option value="Le Kef"> Le Kef</option>
                              <option value="Mahdia"> Mahdia</option>
                                <option value="Médenine"> Médenine</option>
                                  <option value="Monastir"> Monastir</option>
                                    <option value="Nabeul"> Nabeul</option>
                                      <option value="Sfax"> Sfax</option>
                                        <option value="Sidi Bouzid"> Sidi Bouzid</option>
                                          <option value="Siliana"> Siliana</option>
                                            <option value="Sousse"> Sousse</option>
                                              <option value="Tataouine"> Tataouine</option>
                                                <option value="Tozeur"> Tozeur</option>
                                                  <option value="Tunis"> Tunis</option>
                                                    <option value="Zaghouan"> Zaghouan</option>
       
                                 

       </select>
     
        <div *ngIf="suform.ville.touched && suform.ville.invalid">
          <div *ngIf="suform.ville.errors.required" class="alert alert-danger">
           <i class="fas fa-minus-circle"></i> Please choose a City !
          </div>
          </div>
</div>
</div>

 
    

       <div class="form-group">
        <label for="inputText3" class="col-form-label" >Email</label>
        <input type="text" class="form-control" id="inputText3" formControlName="email" value="{{storeUpdate.email}}" >
        <div *ngIf="suform.email.touched && suform.email.invalid">
                <div *ngIf="suform.email.errors.required" class="alert alert-danger">
                 <i class="fas fa-minus-circle"></i> Email Is Required!
                
                </div>
                <div *ngIf="suform.email.errors.pattern" class="alert alert-danger">
                  <i class="fas fa-minus-circle"></i>Invalid E-mail!
                </div>
                </div>
     </div>
     <div class="form-group">
      <label for="inputText3" class="col-form-label" >Phone number</label>
      <input type="text" class="form-control" id="inputText3" formControlName="phnbr" value="{{storeUpdate.phoneNumber}}" >
      <div *ngIf="suform.phnbr.touched && suform.phnbr.invalid">
              <div *ngIf="suform.phnbr.errors.required" class="alert alert-danger">
               <i class="fas fa-minus-circle"></i> Phone number Is Required!

             
              </div>
                <div *ngIf="suform.phnbr.errors.maxlength||suform.phnbr.errors.minlength" class="alert alert-danger">
                <i class="fas fa-minus-circle"></i> Phone must have 8 numbers!
                </div>
            
              </div>
   </div>
       <!--Map--> 
       <div class="container">
          
        <div class="form-group">
          <label>Address</label>
          <input type="text" class="form-control" (keydown.enter)="$event.preventDefault()" value="{{address}}"  autocorrect="on" autocapitalize="on" spellcheck="off" type="text" #search [readonly]="true">
        </div>
       
        <agm-map [latitude]="latitude" [longitude]="longitude" [zoom]="zoom">
          <agm-marker [latitude]="latitude" [longitude]="longitude" [markerDraggable]="true"
            (dragEnd)="markerDragEnd($event)"></agm-marker>
        </agm-map>
       
        <h5>Address: {{address}}</h5>
        <!--
        <div>Latitude: {{latitude}}</div>
        <div>Longitude: {{longitude}}</div>
        -->
      </div>       
                        <div class="modal-footer">
                        <button class="btn btn-outline-dark" (click)="updateStore()" >Validate</button>
                      </div>
                    </form>
                  </div>
                 
                   
               
              </ng-template>
  
<!--  Affect products-->

<ng-template  #content2 let-modal  >
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Affect Products</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
   <div class="row">

      <div class="col-lg-12">
          <a href="/admin/store#storeProduct" class="col-lg-12">
          <div class="card">
              <h5 class="card-header">Products available</h5>
              <div class="card-body">

                  <div class="table-responsive">
                    
                      <table class="table table-striped table-bordered first">
                          <thead>
                              <tr>
                                  <th>Name</th>
                                  <th>Quantity </th>
                                  
                                  
                                  
                              </tr>
                          </thead>
                          <tbody *ngFor="let k of listproducts" >

                          

                             <tr *ngIf="k.disponible==1" (click)="affect(k)" class="affectprod"  > 
                                
                                
                                     <td>{{k.label}} </td>
                                     <td>{{k.qte}}</td>
                                     
                                     
                                 
                              </tr>
                            
                          </tbody>
                     

                        
                          <tfoot>
                              <tr>
                                <th>Name</th>
                                <th>Quantity </th>
                               
                              </tr>
                          </tfoot>
                      </table>
                    
                  </div>
              </div>
          </div>
        </a>
      </div>

      <div class="col-lg-12" id="storeProduct">
          <h2 style="text-align: center;">  <i class="fas fa-long-arrow-alt-down">  </i> </h2>

          
          <form [formGroup]="storeProductForm" [hidden]="showstoreprod">

              <div *ngIf="prod!=null">
                  <h2 style="text-align: center;"> {{prod.label}} </h2>
               

              <div class="form-row">
                   <div class="form-group col-md-6">
                      <label for="inputText3" class="col-form-label" >Quantity</label>
                      <input type="number" class="form-control" id="inputText3" formControlName="qte" >
                      <div *ngIf="sp.qte.touched && sp.qte.invalid">
                          <div *ngIf="sp.qte.errors.required" class="alert alert-danger">
                           <i class="fas fa-minus-circle"></i> Quantity Is Required !
                          </div>
                        
                          </div>
                          <div  class="alert alert-danger" [hidden]="qteError">
                              <i class="fas fa-minus-circle"></i> The Quantity must be lower than {{prod.qte}}
                              </div>
                   </div>
                  <div class="form-group col-md-2">
                      <label for="inputText3" class="col-form-label"> &nbsp; </label>
                      <input type="text" class="form-control" id="inputText3" value="/" disabled style="text-align: center;"> 
                  </div>

                  <div class="form-group col-md-4" *ngIf="prod!=null">
                    <label for="inputText3" class="col-form-label">Available Quantity</label>
                    <input type="text" class="form-control" id="inputZip" value="{{prod.qte}}" disabled style="background-color:lightgray;text-align: center;">
                  </div>
                </div>
            
              <div class="form-group">
                  <label for="inputText3" class="col-form-label" >Date Entry</label>
                  <input id="dateOfBirth" type="date" class="form-control" placeholder="yyyy-mm-dd"  formControlName="date" >
                  <div *ngIf="sp.date.touched && sp.date.invalid">
                      <div *ngIf="sp.date.errors.required" class="alert alert-danger">
                       <i class="fas fa-minus-circle"></i> Date Is Required !
                      </div>
                      </div>
               </div>
             
             <button class="btn btn-primary" (click)="addstoreProduct()" [disabled]="storeProductForm.invalid" > ADD</button>
            </div>
         </form>
       </div>

      <div class="col-lg-12">
          <div class="card">
              <h5 class="card-header">Store Products</h5>
              <div class="card-body">
                 
                <h3 style="text-align: center;"> {{msg}} </h3>
               <h2 style="text-align: center;"> <button class="btn btn-dark" (click)="viewListsp()" [disabled]="noview">View List</button></h2>

               <div class="table-responsive" [hidden]="showitafter">
                    
                  <table class="table table-striped table-bordered first" >
                      <thead>
                          <tr>
                              <th>StoreName</th>
                              <th>ProductName </th>
                              <th>DateEntry</th>
                              <th>Quantity</th>
                              
                              
                              
                          </tr>
                      </thead>
                      <tbody *ngFor="let sp of listStoreProduct"  >

                      

                         <tr > 
                            
                            
                                 <td>{{sp.stores.name}} </td>
                                 <td>{{sp.products.label}}</td>
                                 <td>{{sp.dateEntry}} </td>
                                 <td>{{sp.qte}}</td>
                                 
                                 
                             
                          </tr>
                        
                      </tbody>
                 

                    
                      <tfoot>
                          <tr>
                              <th>StoreName</th>
                              <th>ProductName </th>
                              <th>DateEntry</th>
                              <th>Quantity</th>
                           
                          </tr>
                      </tfoot>
                  </table>
                  </div>



              </div>
          </div>
      </div>
    
 
     
    </div>
   
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Close</button>
  </div>
</ng-template>



<!-- SHOW STORE PRODUCTS-->



<ng-template #content3 let-modal>
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">List Store Products</h4>
      <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">

        <div class="table-responsive">
                    
            <table class="table table-striped table-bordered first" >
                <thead>
                    <tr>
                        <th>StoreName</th>
                        <th>ProductName </th>
                        <th>DateEntry</th>
                        <th>Quantity</th>
                        <th><i class="fas fa-trash-alt"> </i> Delete</th>

                        
                        
                        
                    </tr>
                </thead>


                       
        
               <tbody *ngIf="listStoreProduct=='';else aadi">
                  <tr>
                    <td colspan="5" style="text-align: center;"> No Product found in these store! </td>
                   
                  </tr>

                </tbody>
             
         


                <ng-template #aadi>
                <tbody *ngFor="let sp of listStoreProduct"  >
                
                   <tr > 
                      
                      
                           <td>{{sp.stores.name}} </td>
                           <td>{{sp.products.label}}</td>
                           <td>{{sp.dateEntry}} </td>
                           <td>{{sp.qte}}</td>
                           <td><button class="btn btn-danger" (click)="delete1(sp.id)">Delete</button></td>
                           
                           
                       
                    </tr>
                  
                </tbody>
           
              </ng-template>
              
                <tfoot>
                    <tr>
                        <th>StoreName</th>
                        <th>ProductName </th>
                        <th>DateEntry</th>
                        <th>Quantity</th>
                        <th><i class="fas fa-trash-alt"> </i> Delete</th>
                     
                    </tr>
                </tfoot>
            </table>
            </div>


    
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')">Close</button>
    </div>
  </ng-template>